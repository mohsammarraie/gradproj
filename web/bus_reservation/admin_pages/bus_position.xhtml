<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>#{msgs.app_title}</title>
    </h:head>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyAT-PnUumnLEeph1uswtj11VoLEjdeO_90"></script>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <h:body> 
        <ui:decorate template="/app_templates/app_template.xhtml">   
     
            <p:gmap widgetVar="w_gmap" type="roadmap" center="0, 0" zoom="16" style="width:600px;height:400px" />       

            <script type="text/javascript">
                if (navigator.geolocation) {
                    checkGeolocationByHTML5();
                } else {
                    checkGeolocationByLoaderAPI(); // HTML5 not supported go back to Loader API.
                }

                function checkGeolocationByHTML5() {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        setMapCenter(position.coords.latitude, position.coords.longitude);
                    }, function() {
                        checkGeolocationByLoaderAPI(); // Error go back to Loader API.
                    });
                }

                function checkGeolocationByLoaderAPI() {
                    if (google.loader.ClientLocation) {
                        setMapCenter(google.loader.ClientLocation.latitude, google.loader.ClientLocation.longitude);
                    } else {
                        alert("Unsupported");
                    }
                }

                function setMapCenter(latitude, longitude) {
                   PF('w_gmap').getMap().setCenter(new google.maps.LatLng(latitude, longitude));
                   currentMarker = new google.maps.Marker({
                   position:new google.maps.LatLng(latitude, longitude)
            });
                   PF('w_gmap').addOverlay(currentMarker);
                   
                   setTimeout(function(){
                        location.reload(); //Reload after certain amount of time
                    },5000);

                }
            </script>
            
            <h:form>
              
            </h:form>            
            
            <h:commandButton styleClass="commandButton" style="float:right" value="Contact Driver" actionListener="#{driverInformationBean.phone}"/>

        </ui:decorate>
    </h:body>
</html>
